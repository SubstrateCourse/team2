作业题：

1. 设计如何实现transfer kitty赠予小猫这个功能。分析是否需要修改或者新增storage结构，如何修改。使用伪代码解释流程。加分项：复杂度优于O(n), n=用户拥有的小猫数量。

答：因为现有OwnedKitties用的是一个编号序列来存储，原主人删除该kitty编号时，此编号后面的元素都需要往前挪动一个数字，时间复杂度为O(n)。

如果需要优化时间操作复杂度，可以采用链表来解决这个问题。
<1>维护一个map叫Owned_kitties_linkedList，key是猫主人，value是猫表主人的链表头元素地址
<2>每个猫主人链表的节点，分为三部分。第一部分是上一个节点的reference，第二个部分是下一个节点的reference，第三部分是小猫的index。头元素的上一个节点为空，尾元素的下一个节点为头元素。
<3>这样，如果某个猫主人A要赠予猫给另一个人B，只要知道他要赠予他的第几只猫，找到这个节点，前后节点reference改一下，再把节点添加到B的链条末端，就可以了。当然A和B的OwnedKittiesCount要做相应的更新。


伪代码：

fn transfer_kitty(origin, receiver, user_kitty_index){

  //从原主人列表里取出操作节点
  operating_node = owned_kitties_linkedList.get(origin, user_kitty_index)

  //把操作节点前后连上
  prev_node = operating_node.prev
  next_node = operating_node.next
  operating_kitty_index = operating_node.kitty_index

  prev_node.next = operating_node.next
  next_node.prev = operating_node.prev

  //更新原主人拥有的小猫总数
  OwnedKittiesCount::insert(origin, OwnedKittiesCount.get(origin)-1)


  //把取出来的小猫加到新主人的链条尾巴上
  receiver_kitties_num = OwnedKittiesCount.get(receiver)
  last_node = owned_kitties_linkedList.get(receiver, receiver_kitties_num)

  operating_node.prev = last_node
  operating_node.next = last_node.next
  last_node.next = operating_node

  //更新新主人拥有的小猫总数
  OwnedKittiesCount::insert(receiver, receiver_kitties_num+1)

}




2. 设计如何实现简单的交易功能，用户可以给自己小猫定价，然后其它人可以出钱购买。分析新增的storage数据结构。使用伪代码解释流程。

答：
<1>在上一题的Owned_kitties_linkedList的节点上，再加一个属性，叫做price。这个记录主人对小猫的定价。主人可以调用set_kitty_price函数来设定节点上的小猫价格。节点上的小猫价格默认为0。如果主人没有设置过，或者设置为0，则前端不开放小猫出售。
<2>如果主人A设置了小猫aaa的价格为50，B出价100去购买这只猫。程序先去比较B的出价是否大于等于A的要价，且B是否有这么多钱。如果上面两个条件都满足的话，程序就会把B的钱转给A，并且调用transfer_kitty的功能来转移小猫aaa的所有权。如果上面两个条件没完全满足，会弹出个消息给B，说明购买失败。


伪代码：

set_price(origin, user_kitty_id, price){

  //取得节点
  operating_node = owned_kitties_linkedList.get(origin, user_kitty_index)
  //设置价格
  operating_node.kitty_price = price

}

purchase_kitty(origin, seller_id, seller_kitty_id, offer, owned_money){

  //取得节点
  operating_node = owned_kitties_linkedList.get(seller_id, seller_kitty_id)
  tag_price = operating_node.kitty_price

  //看看购买者出价够不够，钱够不够
  if (offer >= tag_price) & (offer <= owned_money):
    transfer_kitty(seller_id, origin, seller_kitty_id)
  else:
    throw Error("offer is too low or not enough money.")


}